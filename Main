function render() {
  listEl.innerHTML = '';
  summaryEl.innerHTML = '';

  if (!state.items.length) {
    listEl.innerHTML = '<p style="color:#888; font-size:13px;">No manifest items yet.</p>';
    return;
  }

  let normal = 0, fridge = 0, controlled = 0;

  // Group items by hospital
  const grouped = {};
  state.items.forEach(item => {
    const key = item.hospital.trim();
    if (!grouped[key]) grouped[key] = [];
    grouped[key].push(item);
    if (item.type === 'normal') normal++;
    if (item.type === 'fridge') fridge++;
    if (item.type === 'controlled') controlled++;
  });

  const hospitals = Object.keys(grouped).sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));

  hospitals.forEach(hospital => {
    // Hospital name as header, only once
    const hospitalDiv = document.createElement('div');
    hospitalDiv.className = 'hospital-header';
    hospitalDiv.textContent = hospital;
    listEl.appendChild(hospitalDiv);

    // All parcels for that hospital listed under the hospital name
    grouped[hospital].forEach(item => {
      const div = document.createElement('div');
      div.className = 'item ' + item.type + (item.loaded ? ' loaded' : '');

      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = !!item.loaded;
      checkbox.addEventListener('change', () => {
        item.loaded = checkbox.checked;
        save();
        render();
      });

      const info = document.createElement('div');
      info.className = 'parcel-info';
      info.style.flex = '1';

      const inv = document.createElement('div');
      inv.className = 'invoice';
      inv.textContent = item.invoice;

      const tag = document.createElement('div');
      tag.className = 'type-tag';
      tag.textContent =
        item.type === 'normal' ? 'Normal' :
        item.type === 'fridge' ? 'Fridge' :
        'Controlled Drug';

      info.appendChild(inv);
      info.appendChild(tag);

      // Remove button
      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn';
      removeBtn.textContent = "Remove";
      removeBtn.addEventListener('click', () => {
        state.items = state.items.filter(i => i.id !== item.id);
        save();
        render();
      });

      div.appendChild(checkbox);
      div.appendChild(info);
      div.appendChild(removeBtn);

      listEl.appendChild(div);
    });
  });

  summaryEl.innerHTML = ''
    + '<span class="pill">Total: ' + state.items.length + '</span>'
    + '<span class="pill">Normal: ' + normal + '</span>'
    + '<span class="pill">Fridge: ' + fridge + '</span>'
    + '<span class="pill">Controlled: ' + controlled + '</span>';
}
